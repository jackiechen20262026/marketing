<%- include("../partials/portal_header", { title, user }) %>

<div class="card" style="margin-bottom:12px">
  <form method="get" action="/portal/leads" style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
    <input name="q" value="<%= q %>" placeholder="搜索公司/联系人/邮箱/电话" style="padding:8px;border-radius:10px;min-width:260px"/>
    <select name="stage" style="padding:8px;border-radius:10px">
      <option value="">全部阶段</option>
      <% stages.forEach(s=>{ %>
        <option value="<%= s %>" <%= s===stage ? "selected" : "" %>><%= s %></option>
      <% }) %>
    </select>
    <button class="btn" type="submit">筛选</button>
  </form>
</div>

<div class="card">
  <div style="font-weight:800;margin-bottom:10px">线索列表</div>
  <table>
    <thead>
      <tr>
        <th>公司</th>
        <th>联系人</th>
        <th>邮箱</th>
        <th>电话</th>
        <th>阶段</th>
        <th>优先级</th>
        <th>来源</th>
        <th>更新时间</th>
      </tr>
    </thead>
    <tbody>
      <% leads.forEach(l=>{ %>
        <tr>
          <td><a href="/portal/leads/<%= l.id %>?tab=overview"><%= l.companyName %></a></td>
          <td><%= l.contactName || "-" %></td>
          <td><%= l.email || "-" %></td>
          <td><%= l.phone || "-" %></td>
          <td><span class="pill"><%= l.stage %></span></td>
          <td><%= l.priority || "-" %></td>
          <td><%= l.source || "-" %></td>
          <td><%= l.updatedAt ? new Date(l.updatedAt).toLocaleString() : "-" %></td>
        </tr>
      <% }) %>
      <% if (!leads.length) { %>
        <tr><td colspan="8" style="color:#b8c7ea">暂无数据</td></tr>
      <% } %>
    </tbody>
  </table>
</div>

<%- include("../partials/portal_footer") %>
